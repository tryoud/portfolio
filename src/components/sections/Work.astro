---
const { site } = Astro.props;
const work = site.work ?? [];
const workSectionLabel = site.workSectionLabel ?? "Ausgewählte Arbeiten";
const workHeading = site.workHeading ?? "Aktuelle Projekte.";
const workSwipeHint = site.workSwipeHint ?? "Wischen zum Entdecken →";
---

<section id="work" class="bg-[#FDFBF7] py-24" aria-labelledby="work-heading">
  <div class="mx-auto max-w-7xl px-6">
    <div class="mb-16">
      <span class="mb-2 block text-sm font-semibold uppercase tracking-wider text-zinc-500">{workSectionLabel}</span>
      <h2 id="work-heading" class="font-display text-4xl italic text-zinc-900 md:text-5xl">{workHeading}</h2>
    </div>
    <div class="relative md:static">
      <p class="mb-3 text-xs font-medium text-zinc-400 sm:hidden" aria-hidden="true">{workSwipeHint}</p>
      <div class="relative -mx-6 overflow-x-auto px-6 snap-x snap-mandatory scroll-smooth touch-pan-y md:overflow-visible md:mx-0 md:px-0">
        <div class="flex gap-6 pb-4 md:gap-8 lg:gap-10 md:justify-center md:flex-wrap">
        {work.map((item) => {
          const imgSrc = (item.image && String(item.image).trim()) || "";
          return (
          <article class="group w-[88vw] min-w-[300px] shrink-0 snap-start md:w-[340px] md:shrink-0 lg:w-[340px]">
            <div class="rounded-2xl focus-within:ring-2 focus-within:ring-zinc-400 focus-within:ring-offset-2">
              <div class="relative mb-5">
                <div
                  class="work-preview-scroll aspect-[16/10] max-sm:overflow-hidden sm:overflow-y-auto overflow-x-hidden rounded-2xl overscroll-contain scroll-smooth [scrollbar-gutter:stable] focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2"
                  tabindex="0"
                  aria-label={`Project screenshot preview: ${item.title}`}
                >
                  {imgSrc ? (
                    <img
                      src={imgSrc}
                      alt={`Screenshot: ${item.title}`}
                      width="800"
                      loading="lazy"
                      decoding="async"
                      class="block w-full h-auto"
                    />
                  ) : (
                    <div class="h-full min-h-[200px] w-full rounded-2xl bg-zinc-200" aria-hidden="true" />
                  )}
                </div>
              </div>
              <a href={item.href} class="block focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2 rounded-2xl">
                <div class="flex items-start justify-between">
                  <div>
                    <h3 class="mb-1 text-2xl font-bold text-zinc-900 decoration-zinc-900 underline-offset-4 group-hover:underline decoration-1">{item.title}</h3>
                    <p class="text-sm text-zinc-500">{item.tags?.join(", ") ?? ""}</p>
                  </div>
                  <span class="text-zinc-400 transition-transform group-hover:translate-x-1" aria-hidden="true">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                  </span>
                </div>
              </a>
            </div>
          </article>
        );})}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Internal scroll: natural image height inside fixed aspect box (override global #work aspect img) */
  :global(#work) .work-preview-scroll img {
    height: auto !important;
    object-fit: unset;
    object-position: unset;
  }

  /* Match light mode viewport in dark mode: global.css applies inset clip-path to .dark #work [class*="aspect-"], which shrinks the visible area; reset so only colors differ */
  @media (min-width: 768px) {
    :global(.dark) :global(#work) .work-preview-scroll {
      clip-path: none;
      -webkit-clip-path: none;
    }
  }
</style>
