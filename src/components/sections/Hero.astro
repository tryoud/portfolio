---
const { site } = Astro.props;
const hero = site.hero ?? {};
const headline = hero.headline ?? "Hey, there";
const badgeText = hero.badgeText ?? "";
const portraitSrc = (hero.portraitSrc && String(hero.portraitSrc).trim()) || "/hero/Nikolas_Maerker_hero.webp";
const primaryCta = hero.primaryCta ?? { label: "Let's talk", href: "#contact" };
const secondaryCta = hero.secondaryCta ?? { label: "View work", href: "#work" };
const primaryHref = typeof primaryCta === "object" && primaryCta.href ? primaryCta.href : "#contact";
const primaryLabel = typeof primaryCta === "object" && primaryCta.label ? primaryCta.label : "Let's talk";
const secondaryHref = typeof secondaryCta === "object" && secondaryCta.href ? secondaryCta.href : "#work";
const secondaryLabel = typeof secondaryCta === "object" && secondaryCta.label ? secondaryCta.label : "View work";
const specialization = hero.specialization ?? "";
const nameLine = site.name ?? "";
const roleLine = site.role ?? "";
const nameUpper = nameLine.toUpperCase().replace(/\s+/g, " ");
const roleUpper = roleLine.toUpperCase();
const roleSegments = roleUpper.split(/\s*·\s*/).filter(Boolean);
const roleDisplayLinesFallback = roleSegments.flatMap((seg) => seg.split(/\s+&\s+/).map((s) => s.trim()).filter(Boolean));
const roleLines = Array.isArray(hero.roleLines) && hero.roleLines.length ? hero.roleLines.map((l) => String(l).toUpperCase()) : roleDisplayLinesFallback;
const roleSubline = (hero.roleSubline && String(hero.roleSubline).trim()) || "";
const nameParts = nameLine.trim().split(/\s+/);
const firstNameUpper = nameParts[0] ? nameParts[0].toUpperCase() : nameUpper;
const lastNameUpper = nameParts.length > 1 ? nameParts.slice(1).join(" ").toUpperCase() : "";
const greetingParts = (headline || "Hey, there").split(/,\s*/);
const greetingLeft = greetingParts[0] ? `${greetingParts[0]},` : "Hey,";
const greetingRight = greetingParts[1] ?? "there";
---

<section class="relative flex min-h-0 max-h-[800px] flex-col overflow-hidden pt-[clamp(1.5rem,4vw,2.5rem)] pb-[clamp(0.75rem,2vw,1.5rem)] md:min-h-[calc(100svh-5rem)] md:pt-8 md:pb-[clamp(0.5rem,1.5vw,1rem)]" aria-labelledby="hero-heading">
  <div class="pointer-events-none absolute inset-0 -z-10" aria-hidden="true">
    <div class="absolute inset-0 bg-[var(--color-background-light)]" />
    <div
      class="hero-portrait-cloud absolute inset-0 opacity-100"
      style="background: radial-gradient(ellipse 65% 55% at 50% 38%, rgb(255, 248, 228) 0%, rgb(255, 244, 218) 30%, rgba(255, 242, 225, 0.4) 55%, transparent 72%);"
    />
  </div>

  <!-- Single centered container: max-w-7xl, no drift on ultra-wide -->
  <div class="relative mx-auto flex min-h-0 w-full max-w-7xl flex-1 flex-col px-4 sm:px-6">
    <h1 id="hero-heading" class="sr-only">{headline} — {nameLine}, {roleLine}</h1>

    <!-- Availability pill: left-mid, inside container -->
    {badgeText ? (
      <div class="relative z-20 flex shrink-0 justify-center pt-2 pb-1 md:absolute md:left-4 md:top-1/2 md:-translate-y-1/2 md:justify-start md:pt-0 md:pb-0 sm:left-6">
        <div class="inline-flex min-h-[44px] min-w-[44px] items-center gap-2 rounded-full border border-zinc-200/70 bg-white/95 px-4 py-2.5 shadow-sm sm:min-h-0 sm:min-w-0 sm:py-2">
          <span class="relative flex h-2.5 w-2.5 shrink-0" aria-hidden="true">
            <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-amber-400 opacity-75" />
            <span class="relative inline-flex h-2.5 w-2.5 rounded-full bg-amber-500" />
          </span>
          <span class="text-xs font-medium tracking-wide text-zinc-700 sm:text-xs">{badgeText}</span>
        </div>
      </div>
    ) : null}

    <!-- "Hey, there": one baseline, centered behind portrait head; on mobile above portrait so visible -->
    <div class="pointer-events-none absolute left-1/2 top-[34%] z-10 flex -translate-x-1/2 translate-y-[60px] items-baseline justify-center gap-[clamp(2rem,40vw,15rem)] sm:top-[30%] sm:-translate-y-[40px] sm:gap-[clamp(3rem,40vw,15rem)] md:z-0 md:top-[32%]" aria-hidden="true">
      <span class="font-display text-[clamp(1.5rem,5vw,8rem)] font-medium italic leading-tight tracking-[-0.02em] text-zinc-900/35 sm:text-[clamp(1.75rem,5.5vw,9rem)] md:text-[clamp(2.5rem,8vw,10rem)] md:text-zinc-900/30">{greetingLeft}</span>
      <span class="font-display text-[clamp(1.5rem,5vw,8rem)] font-medium italic leading-tight tracking-[-0.02em] text-zinc-900/35 sm:text-[clamp(1.75rem,5.5vw,9rem)] md:text-[clamp(2.5rem,8vw,10rem)] md:text-zinc-900/30">{greetingRight}</span>
    </div>

    <!-- Portrait: centered, no offset; bottom fade preserved -->
    <div class="relative z-10 flex min-h-0 flex-1 flex-col items-center justify-center py-[clamp(0.25rem,1vw,0.5rem)] md:py-0">
      <div class="mx-auto w-64 shrink-0 translate-x-[40px] translate-y-[60px] scale-[1.2] sm:w-80 md:w-[28rem] lg:w-[34rem] xl:w-[min(440px,90vw)] [filter:drop-shadow(0_25px_50px_-12px_rgba(0,0,0,0.15))_drop-shadow(0_0_40px_-8px_rgba(0,0,0,0.08))]">
        <img
          src={portraitSrc}
          alt=""
          class="h-auto w-full object-contain object-center"
          width="480"
          height="640"
          loading="eager"
          decoding="async"
          fetchpriority="high"
          style="-webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 75%, rgba(0,0,0,0) 100%); mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 75%, rgba(0,0,0,0) 100%); -webkit-mask-size: cover; mask-size: cover;"
        />
      </div>
    </div>

    {specialization ? (
      <div class="absolute right-4 top-auto z-20 hidden text-right text-sm leading-relaxed text-zinc-600 lg:right-6 lg:top-[50%] lg:block lg:max-w-[280px] lg:-translate-y-1/2 xl:max-w-[320px]">
        <p>{specialization}</p>
      </div>
    ) : null}

    <!-- Bottom band: 3-col grid, same baseline, within container -->
    <div class="relative z-20 shrink-0 px-0 pt-[clamp(0.5rem,1.5vw,1rem)] pb-[clamp(0.5rem,1.5vw,1rem)] sm:px-0">
      <div class="grid w-full grid-cols-2 items-end gap-3 md:grid-cols-3 md:gap-4">
        <div class="flex min-w-0 flex-col items-start gap-0.5">
          <span class="block select-none text-sm font-bold uppercase tracking-tight text-zinc-400 sm:text-lg md:text-xl lg:text-2xl xl:text-3xl" aria-hidden="true">I AM</span>
          <span class="block text-lg font-bold uppercase tracking-tight text-zinc-900 sm:text-2xl md:text-4xl lg:text-5xl xl:text-6xl 2xl:text-6xl" aria-hidden="true">{firstNameUpper}</span>
          {lastNameUpper ? <span class="block text-lg font-bold uppercase tracking-tight text-zinc-900 sm:text-2xl md:text-4xl lg:text-5xl xl:text-6xl 2xl:text-6xl" aria-hidden="true">{lastNameUpper}</span> : null}
        </div>
        <div class="hidden items-end justify-self-center md:flex md:flex-col">
          <div class="flex flex-row justify-center gap-3 lg:gap-5">
            <a
              href={primaryHref}
              class="inline-flex min-h-[48px] items-center justify-center rounded-xl bg-[var(--accent)] px-6 py-3 text-sm font-medium text-[var(--accent-foreground)] shadow-md hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-[var(--ring)] focus:ring-offset-2 focus:ring-offset-[var(--ring-offset)] transition-colors"
            >
              {primaryLabel}
            </a>
            <a
              href={secondaryHref}
              class="inline-flex min-h-[48px] items-center justify-center rounded-xl border-2 border-zinc-900 px-6 py-3 text-sm font-medium text-zinc-900 hover:bg-zinc-50 focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2 transition-colors"
            >
              {secondaryLabel}
            </a>
          </div>
        </div>
        <div class="flex min-w-0 flex-col items-end gap-0.5 text-right">
          {roleLines.length ? roleLines.map((line) => (
            <span class="block text-xs font-bold uppercase tracking-tight leading-tight text-zinc-900 sm:text-sm md:text-xl lg:text-2xl xl:text-3xl" aria-hidden="true">{line}</span>
          )) : (
            <span class="block text-xs font-bold uppercase tracking-tight leading-tight text-zinc-900 sm:text-sm md:text-xl lg:text-2xl xl:text-3xl" aria-hidden="true">{roleUpper}</span>
          )}
          {roleSubline ? (
            <span class="mt-1 block text-xs font-medium uppercase tracking-wide text-zinc-500 sm:text-sm" aria-hidden="true">{roleSubline}</span>
          ) : null}
        </div>
      </div>
    </div>
  </div>
</section>
