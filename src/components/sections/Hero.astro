---
const { site } = Astro.props;
const hero = site.hero ?? {};
const headline = hero.headline ?? "Hey, there";
const badgeText = hero.badgeText ?? "";
const portraitSrc = (hero.portraitSrc && String(hero.portraitSrc).trim()) || "/hero/Nikolas_Maerker_hero.webp";
const primaryCta = hero.primaryCta ?? { label: "Let's talk", href: "#contact" };
const secondaryCta = hero.secondaryCta ?? { label: "View work", href: "#work" };
const primaryHref = typeof primaryCta === "object" && primaryCta.href ? primaryCta.href : "#contact";
const primaryLabel = typeof primaryCta === "object" && primaryCta.label ? primaryCta.label : "Let's talk";
const secondaryHref = typeof secondaryCta === "object" && secondaryCta.href ? secondaryCta.href : "#work";
const secondaryLabel = typeof secondaryCta === "object" && secondaryCta.label ? secondaryCta.label : "View work";
const specialization = hero.specialization ?? "";
const nameLine = site.name ?? "";
const roleLine = site.role ?? "";
const nameUpper = nameLine.toUpperCase().replace(/\s+/g, " ");
const roleUpper = roleLine.toUpperCase();
const roleSegments = roleUpper.split(/\s*·\s*/).filter(Boolean);
const roleDisplayLinesFallback = roleSegments.flatMap((seg) => seg.split(/\s+&\s+/).map((s) => s.trim()).filter(Boolean));
const roleLines = Array.isArray(hero.roleLines) && hero.roleLines.length ? hero.roleLines.map((l) => String(l).toUpperCase()) : roleDisplayLinesFallback;
const roleSubline = (hero.roleSubline && String(hero.roleSubline).trim()) || "";
const nameParts = nameLine.trim().split(/\s+/);
const firstNameUpper = nameParts[0] ? nameParts[0].toUpperCase() : nameUpper;
const lastNameUpper = nameParts.length > 1 ? nameParts.slice(1).join(" ").toUpperCase() : "";
const greetingParts = (headline || "Hey, there").split(/,\s*/);
const greetingLeft = greetingParts[0] ? `${greetingParts[0]},` : "Hey,";
const greetingRight = greetingParts[1] ?? "there";
---

<section id="top" class="relative flex min-h-0 flex-col overflow-x-hidden pt-10 pb-6 gradient-mesh md:min-h-[calc(100svh-5rem)] md:pt-12" aria-labelledby="hero-heading">
  <div class="pointer-events-none absolute inset-0 -z-10" aria-hidden="true">
    <div class="absolute inset-0 bg-gradient-to-b from-white via-amber-50/40 to-zinc-100/80" />
    <div class="absolute left-1/2 top-[55%] h-[70%] w-[50%] min-w-[280px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-amber-200/25 blur-3xl" />
    <div class="absolute bottom-0 left-0 right-0 h-40 bg-gradient-to-b from-transparent to-white" />
  </div>

  <!-- Centered container: fixed max-width so layout does not drift on ultra-wide -->
  <div class="relative mx-auto flex min-h-0 w-full max-w-7xl flex-1 flex-col px-4 sm:px-6">
    <h1 id="hero-heading" class="sr-only">{headline} — {nameLine}, {roleLine}</h1>

    <!-- LAYER 1: background words — "Hey," visible on mobile (higher, slightly more opacity); "there" hidden on mobile -->
    <div class="pointer-events-none absolute left-1/2 top-[6%] z-0 flex -translate-x-1/2 items-baseline gap-[clamp(2rem,8vw,10rem)] sm:top-[10%] sm:gap-[clamp(3rem,10vw,12rem)] md:top-[18%] md:gap-[clamp(4rem,10vw,14rem)] lg:top-[20%]" aria-hidden="true">
      <span class="font-display text-[clamp(1.5rem,5vw,8rem)] font-medium italic leading-tight tracking-[-0.02em] text-zinc-900/35 sm:text-[clamp(1.75rem,5.5vw,9rem)] md:text-[clamp(2.5rem,8vw,10rem)] md:text-zinc-900/30">{greetingLeft}</span>
      <span class="hidden font-display text-[clamp(1.75rem,5.5vw,9rem)] font-medium italic leading-tight tracking-[-0.02em] text-zinc-900/30 md:inline md:text-[clamp(2.5rem,8vw,10rem)] md:text-zinc-900/30">{greetingRight}</span>
    </div>

    <!-- LAYER 2a: pill — in flow on mobile (first); absolute mid-left on desktop -->
    {badgeText ? (
      <div class="relative z-20 flex justify-center pt-2 pb-2 md:absolute md:left-6 md:top-1/2 md:-translate-y-1/2 md:justify-start md:pt-0 md:pb-0">
        <div class="inline-flex min-h-[44px] min-w-[44px] items-center gap-2 rounded-full border border-zinc-200/70 bg-white/95 px-4 py-2.5 shadow-sm sm:min-h-0 sm:min-w-0 sm:py-2">
          <span class="relative flex h-2.5 w-2.5 shrink-0" aria-hidden="true">
            <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-amber-400 opacity-75" />
            <span class="relative inline-flex h-2.5 w-2.5 rounded-full bg-amber-500" />
          </span>
          <span class="text-xs font-medium tracking-wide text-zinc-700 sm:text-xs">{badgeText}</span>
        </div>
      </div>
    ) : null}

    <!-- LAYER 2b: portrait — centered; no flex-1 so CTAs stay directly below, not pushed to bottom -->
    <div class="relative z-10 flex flex-col items-center justify-start pt-0 pb-1">
      <div class="mx-auto w-64 shrink-0 sm:w-72 md:w-96 lg:w-[32rem] xl:w-[420px] xl:max-w-[min(420px,90vw)] [filter:drop-shadow(0_25px_50px_-12px_rgba(0,0,0,0.15))_drop-shadow(0_0_40px_-8px_rgba(0,0,0,0.08))]">
        <img
          src={portraitSrc}
          alt=""
          class="h-auto w-full object-contain object-center"
          width="480"
          height="640"
          loading="eager"
          decoding="async"
          fetchpriority="high"
          style="-webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 75%, rgba(0,0,0,0) 100%); mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 75%, rgba(0,0,0,0) 100%); -webkit-mask-size: cover; mask-size: cover;"
        />
      </div>
    </div>

    <!-- LAYER 3B: specialization — mid-right on desktop only -->
    {specialization ? (
      <div class="absolute right-4 top-auto z-20 hidden text-right text-sm leading-relaxed text-zinc-600 lg:right-6 lg:top-[58%] lg:block lg:max-w-[280px] lg:-translate-y-1/2 xl:max-w-[320px]">
        <p>{specialization}</p>
      </div>
    ) : null}

    <!-- LAYER 3: CTAs — directly under portrait, centered; hidden on phone -->
    <div class="relative z-20 hidden w-full justify-center pb-2 pt-4 md:flex">
      <div class="flex w-full max-w-[280px] flex-col gap-3 sm:max-w-none sm:flex-row sm:justify-center sm:gap-5">
        <a
          href={primaryHref}
          class="inline-flex min-h-[48px] items-center justify-center rounded-xl bg-zinc-900 px-6 py-3.5 text-sm font-medium text-white shadow-md hover:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2 transition-colors sm:py-3"
        >
          {primaryLabel}
        </a>
        <a
          href={secondaryHref}
          class="inline-flex min-h-[48px] items-center justify-center rounded-xl border-2 border-zinc-900 px-6 py-3.5 text-sm font-medium text-zinc-900 hover:bg-zinc-50 focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2 transition-colors sm:py-3"
        >
          {secondaryLabel}
        </a>
      </div>
    </div>

    <!-- LAYER 4: name and role — 2-col grid on mobile (left/right); absolute pinned on desktop; single max-w container -->
    <div class="mt-6 flex flex-col gap-6 pb-4 md:absolute md:bottom-6 md:left-0 md:right-0 md:mt-0 md:pb-0">
      <div class="mx-auto grid w-full max-w-7xl grid-cols-2 items-end gap-3 px-4 sm:gap-4 sm:px-6 md:flex md:flex-row md:items-end md:justify-between md:gap-6">
        <div class="flex min-w-0 flex-col gap-0.5">
          <span class="block select-none text-sm font-bold uppercase tracking-tight text-zinc-400 sm:text-lg md:text-xl lg:text-2xl xl:text-3xl" aria-hidden="true">I AM</span>
          <span class="block text-lg font-bold uppercase tracking-tight text-zinc-900 sm:text-2xl md:text-4xl lg:text-5xl xl:text-6xl 2xl:text-6xl" aria-hidden="true">{firstNameUpper}</span>
          {lastNameUpper ? <span class="block text-lg font-bold uppercase tracking-tight text-zinc-900 sm:text-2xl md:text-4xl lg:text-5xl xl:text-6xl 2xl:text-6xl" aria-hidden="true">{lastNameUpper}</span> : null}
        </div>
        <div class="flex min-w-0 flex-col items-end gap-0.5 text-right sm:items-end md:items-end md:text-right">
          {roleLines.length ? roleLines.map((line) => (
            <span class="block text-xs font-bold uppercase tracking-tight leading-tight text-zinc-900 sm:text-sm md:text-xl lg:text-2xl xl:text-3xl" aria-hidden="true">{line}</span>
          )) : (
            <span class="block text-xs font-bold uppercase tracking-tight leading-tight text-zinc-900 sm:text-sm md:text-xl lg:text-2xl xl:text-3xl" aria-hidden="true">{roleUpper}</span>
          )}
          {roleSubline ? (
            <span class="mt-1 block text-xs font-medium uppercase tracking-wide text-zinc-500 sm:text-sm" aria-hidden="true">{roleSubline}</span>
          ) : null}
        </div>
      </div>
    </div>
  </div>
</section>
